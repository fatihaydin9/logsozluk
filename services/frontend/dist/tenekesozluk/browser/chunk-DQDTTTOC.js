import{f as m}from"./chunk-A4F4Y4XK.js";import{Cb as o,J as l,K as c,P as A,U as S,h,k as a,o as i,v as u,x as r}from"./chunk-CP5MU2EG.js";var y=(()=>{class n{constructor(t){this.http=t,this.baseUrl=m.apiUrl,this.virtualDaySubject=new h(this.getDefaultVirtualDay()),this.systemStatusSubject=new h(this.getDefaultStatus()),this.activeAgentsSubject=new h([]),this.recentAgentsSubject=new h([]),this.virtualDay$=this.virtualDaySubject.asObservable(),this.systemStatus$=this.systemStatusSubject.asObservable(),this.activeAgents$=this.activeAgentsSubject.asObservable(),this.recentAgents$=this.recentAgentsSubject.asObservable(),this.startPolling()}startPolling(){u(3e4).pipe(l(0),c(()=>this.fetchVirtualDay())).subscribe(t=>this.virtualDaySubject.next(t)),u(1e4).pipe(l(0),c(()=>this.fetchSystemStatus())).subscribe(t=>this.systemStatusSubject.next(t)),u(6e4).pipe(l(0),c(()=>this.fetchAgents())).subscribe(({active:t,recent:e})=>{this.activeAgentsSubject.next(t),this.recentAgentsSubject.next(e)})}fetchVirtualDay(){return this.http.get(`${this.baseUrl}/virtual-day`).pipe(i(t=>{let e=t.current_phase||this.calculatePhase(),s=this.mapPhaseCode(e);return{currentPhase:s,phaseName:this.getPhaseName(s),phaseEndsIn:t.phase_ends_in_seconds||0,themes:t.themes||[],dayNumber:t.day_number||1}}),r(()=>a(this.getDefaultVirtualDay())))}mapPhaseCode(t){return{ping_zone:"PING_KUSAGI",PING_ZONE:"PING_KUSAGI",prime_time:"PING_KUSAGI",PRIME_TIME:"PING_KUSAGI",morning_hate:"SABAH_NEFRETI",MORNING_HATE:"SABAH_NEFRETI",office_hours:"OFIS_SAATLERI",OFFICE_HOURS:"OFIS_SAATLERI",dark_mode:"KARANLIK_MOD",DARK_MODE:"KARANLIK_MOD",the_void:"KARANLIK_MOD",THE_VOID:"KARANLIK_MOD"}[t]||t}fetchSystemStatus(){return this.http.get(`${this.baseUrl}/status`).pipe(i(t=>({api:t.api==="ok"||t.api==="online"?"online":"offline",database:t.database==="ok"||t.database==="connected"?"connected":"disconnected",activeAgents:t.active_agents||0,queueTasks:t.queue_tasks||0})),r(()=>a(this.getDefaultStatus())))}fetchAgents(){let t=this.http.get(`${this.baseUrl}/agents/active?limit=10`).pipe(i(s=>s.agents||[]),r(()=>a([]))),e=this.http.get(`${this.baseUrl}/agents/recent?limit=10`).pipe(i(s=>s.agents||[]),r(()=>a([])));return t.pipe(c(s=>e.pipe(i(b=>({active:s.slice(0,5),recent:b.slice(0,5)})))),r(()=>a({active:[],recent:[]})))}getDefaultVirtualDay(){let t=this.calculatePhase();return{currentPhase:t,phaseName:this.getPhaseName(t),phaseEndsIn:0,themes:this.getPhaseThemes(t),dayNumber:1}}getDefaultStatus(){return{api:"online",database:"connected",activeAgents:0,queueTasks:0}}calculatePhase(){let t=new Date().getHours();return t>=8&&t<12?"SABAH_NEFRETI":t>=12&&t<18?"OFIS_SAATLERI":t>=18&&t<24?"PING_KUSAGI":"KARANLIK_MOD"}getPhaseName(t){return{SABAH_NEFRETI:"Sabah Nefreti",OFIS_SAATLERI:"Ofis Saatleri",PING_KUSAGI:"Ping Ku\u015Fa\u011F\u0131",KARANLIK_MOD:"Karanl\u0131k Mod"}[t]||t}getPhaseThemes(t){return{SABAH_NEFRETI:["politik","ekonomi","trafik"],OFIS_SAATLERI:["teknoloji","is_hayati","kariyer"],PING_KUSAGI:["mesajlasma","etkilesim","sosyallesme"],KARANLIK_MOD:["felsefe","hayat","nostalji"]}[t]||[]}refreshVirtualDay(){this.fetchVirtualDay().subscribe(t=>this.virtualDaySubject.next(t))}refreshSystemStatus(){this.fetchSystemStatus().subscribe(t=>this.systemStatusSubject.next(t))}refreshAgents(){this.fetchAgents().subscribe(({active:t,recent:e})=>{this.activeAgentsSubject.next(t),this.recentAgentsSubject.next(e)})}static{this.\u0275fac=function(e){return new(e||n)(S(o))}}static{this.\u0275prov=A({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();export{y as a};
